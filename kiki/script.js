const firebaseConfig = {
    apiKey: "AIzaSyDjdHKJiE9_0-pGZTqfRWIc_YNvYh7dIyg",
    authDomain: "new-ascii-test.firebaseapp.com",
    projectId: "new-ascii-test",
    storageBucket: "new-ascii-test.appspot.com",
    messagingSenderId: "455636189959",
    appId: "1:455636189959:web:ceb7d59a1702505e86bba2",
    measurementId: "G-F38CHL5MY7"
};
firebase.initializeApp(firebaseConfig);
var params = new URLSearchParams(window.location.search);
var username = params.get("data");
const db = firebase.firestore();
const messageContainer = document.querySelector('.messages');
const userRef = db.collection('users').doc(username);
const dmsgs = firebase.database().ref("msgs");
const time1 = firebase.database().ref("time1");
const time2 = firebase.database().ref("time2");
dmsgs.set("");
userRef.get().then((doc) => {
    if (doc.exists) {
        db.collection('messages').orderBy('timestamp', 'asc').onSnapshot((snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === 'added') {
                    const message = change.doc.data();
                    const messageElement = document.createElement('div');
                    const messageElementone = document.createElement('div');
                    const textElement = document.createElement('div');
                    const textNode = document.createTextNode(message.message);
                    const avatarElement = document.createElement('div');
                    avatarElement.className = 'avatar';
                    if (message.message.startsWith(username)) {
                        messageElement.className = 'message right appeared';
                    } else {
                        messageElement.className = 'message left appeared';
                    }
                    var text = textNode.nodeValue;
                    const textWrapperElement = document.createElement('div');
                    textWrapperElement.className = 'text_wrapper';
                    var textToRemove1 = "karan: "
                    var textToRemove2 = "chanchal00: "
                    if (text.indexOf(textToRemove1) === 0) {
                        text = text.replace(new RegExp("^" + textToRemove1), "");
                    } else if (text.indexOf(textToRemove2) === 0) {
                        text = text.replace(new RegExp("^" + textToRemove2), "");
                    }
                    const editedTextNode = document.createTextNode(text);
                    textElement.appendChild(editedTextNode);
                    messageElement.appendChild(avatarElement);
                    textWrapperElement.appendChild(textElement);
                    messageElement.appendChild(textWrapperElement);
                    messageElementone.appendChild(messageElement);
                    messageContainer.appendChild(messageElementone);
                    messageContainer.scrollTop = messageContainer.scrollHeight;
                }
            });
        });
    } else {
        console.log('User does not exist');
    }
}).catch((error) => {
    console.log('Error getting user:', error);
});
const sendMessageButton = document.querySelector('.send_message');
const messageInput = document.querySelector('.message_input');
messageInput.addEventListener("keydown", function(event) {
    // Number 13 is the "Enter" key on the keyboard
    if (event.keyCode === 13) {
        // Cancel the default action, if needed
        const messageText = messageInput.value.trim();
        if (messageText != "") {
            db.collection('messages').add({
                message: `${username}: ${messageText}`,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        messageInput.value = '';
    }
});
sendMessageButton.addEventListener('click', () => {
    const messageText = messageInput.value.trim();
    if (messageText) {
        db.collection('messages').add({
            message: `${username}: ${messageText}`,
            timestamp: firebase.firestore.FieldValue.serverTimestamp() 
        });
        messageInput.value = '';
        messageInput.focus();
    }
});
addEmojis(['ðŸ«‚','ðŸ’•', 'â¤ï¸', 'ðŸ˜š', 'ðŸ˜Œ', 'ðŸ˜­', 'ðŸ¤£', 'ðŸ¥º', 'ðŸ˜—', 'ðŸŒš', 'ðŸ™‚', 'ðŸ˜”', 'ðŸ’‹', 'ðŸ¤¤', 'ðŸ˜©', 'ðŸ˜', 'ðŸ‘', 'ðŸ’', 'ðŸ¤œ', 'ðŸ¤›', 'ðŸ˜', 'ðŸ¥µ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', ' ', 'ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ˜‚', 'ðŸ¤£', 'â˜ºï¸', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Œ', 'ðŸ˜', 'ðŸ¥°', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜™', 'ðŸ˜š', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ¤¨', 'ðŸ§', 'ðŸ¤“', 'ðŸ˜Ž', 'ðŸ¥¸', 'ðŸ¤©', 'ðŸ¥³', 'ðŸ˜', 'ðŸ˜’', 'ðŸ˜ž', 'ðŸ˜”', 'ðŸ˜Ÿ', 'ðŸ˜•', 'ðŸ™', 'â˜¹ï¸', 'ðŸ˜£', 'ðŸ˜–', 'ðŸ˜«', 'ðŸ˜©', 'ðŸ¥º', 'ðŸ˜¢', 'ðŸ˜­', 'ðŸ˜®\u200dðŸ’¨', 'ðŸ˜¤', 'ðŸ˜ ', 'ðŸ˜¡', 'ðŸ¤¬', 'ðŸ¤¯', 'ðŸ˜³', 'ðŸ¥µ', 'ðŸ¥¶', 'ðŸ˜±', 'ðŸ˜¨', 'ðŸ˜°', 'ðŸ˜¥', 'ðŸ˜“', 'ðŸ«£', 'ðŸ¤—', 'ðŸ«¡', 'ðŸ¤”', 'ðŸ«¢', 'ðŸ¤­', 'ðŸ¤«', 'ðŸ¤¥', 'ðŸ˜¶', 'ðŸ˜¶\u200dðŸŒ«ï¸', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¬', 'ðŸ« ', 'ðŸ™„', 'ðŸ˜¯', 'ðŸ˜¦', 'ðŸ˜§', 'ðŸ˜®', 'ðŸ˜²', 'ðŸ¥±', 'ðŸ˜´', 'ðŸ¤¤', 'ðŸ˜ª', 'ðŸ˜µ', 'ðŸ˜µ\u200dðŸ’«', 'ðŸ«¥', 'ðŸ¤', 'ðŸ¥´', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤‘', 'ðŸ¤ ', 'ðŸ˜ˆ', 'ðŸ‘¿', 'ðŸ‘¹', 'ðŸ‘º', 'ðŸ¤¡', 'ðŸ’©', 'ðŸ‘»', 'ðŸ’€', 'â˜ ï¸', 'ðŸ‘½', 'ðŸ‘¾', 'ðŸ¤–', 'ðŸŽƒ', 'ðŸ˜º', 'ðŸ˜¸', 'ðŸ˜¹', 'ðŸ˜»', 'ðŸ˜¼', 'ðŸ˜½', 'ðŸ™€', 'ðŸ˜¿', 'ðŸ˜¾', 'ðŸ‘‹', 'ðŸ¤š', 'ðŸ–', 'âœ‹', 'ðŸ––', 'ðŸ‘Œ', 'ðŸ¤Œ', 'ðŸ¤', 'âœŒï¸', 'ðŸ¤ž', 'ðŸ¤Ÿ', 'ðŸ¤˜', 'ðŸ¤™', 'ðŸ‘ˆ', 'ðŸ‘‰', 'ðŸ‘†', 'ðŸ–•', 'ðŸ‘‡', 'â˜ï¸', 'ðŸ‘', 'ðŸ‘Ž', 'âœŠ', 'ðŸ‘Š', 'ðŸ¤›', 'ðŸ¤œ', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ‘', 'ðŸ¤²', 'ðŸ¤', 'ðŸ™', 'âœï¸', 'ðŸ’…', 'ðŸ¤³', 'ðŸ’ª', 'ðŸ¦¾', 'ðŸ¦µ', 'ðŸ¦¿', 'ðŸ¦¶', 'ðŸ‘£', 'ðŸ‘‚', 'ðŸ¦»', 'ðŸ‘ƒ', 'ðŸ«€', 'ðŸ«', 'ðŸ§ ', 'ðŸ¦·', 'ðŸ¦´', 'ðŸ‘€', 'ðŸ‘', 'ðŸ‘…', 'ðŸ‘„', 'ðŸ’‹', 'ðŸ©¸', 'ðŸ¶', 'ðŸ±', 'ðŸ­', 'ðŸ¹', 'ðŸ°', 'ðŸ¦Š', 'ðŸ»', 'ðŸ¼', 'ðŸ»\u200dâ„ï¸', 'ðŸ¨', 'ðŸ¯', 'ðŸ¦', 'ðŸ®', 'ðŸ·', 'ðŸ½', 'ðŸ¸', 'ðŸµ', 'ðŸ™ˆ', 'ðŸ™‰', 'ðŸ™Š', 'ðŸ’', 'ðŸ”', 'ðŸ§', 'ðŸ¦', 'ðŸ¤', 'ðŸ£', 'ðŸ¥', 'ðŸ¦†', 'ðŸ¦…', 'ðŸ¦‰', 'ðŸ¦‡', 'ðŸº', 'ðŸ—', 'ðŸ´', 'ðŸ¦„', 'ðŸ', 'ðŸª±', 'ðŸ›', 'ðŸ¦‹', 'ðŸŒ', 'ðŸž', 'ðŸœ', 'ðŸª°', 'ðŸª²', 'ðŸª³', 'ðŸ¦Ÿ', 'ðŸ¦—', 'ðŸ•·', 'ðŸ•¸', 'ðŸ¦‚', 'ðŸ¢', 'ðŸ', 'ðŸ¦Ž', 'ðŸ¦–', 'ðŸ¦•', 'ðŸ™', 'ðŸ¦‘', 'ðŸ¦', 'ðŸ¦ž', 'ðŸ¦€', 'ðŸª¸', 'ðŸ¡', 'ðŸ ', 'ðŸŸ', 'ðŸ¬', 'ðŸ³', 'ðŸ‹', 'ðŸ¦ˆ', 'ðŸŠ', 'ðŸ…', 'ðŸ†', 'ðŸ¦“', 'ðŸ¦', 'ðŸ¦§', 'ðŸ¦£', 'ðŸ˜', 'ðŸ¦›', 'ðŸ¦', 'ðŸª', 'ðŸ«', 'ðŸ¦’', 'ðŸ¦˜', 'ðŸ¦¬', 'ðŸƒ', 'ðŸ‚', 'ðŸ„', 'ðŸŽ', 'ðŸ–', 'ðŸ', 'ðŸ‘', 'ðŸ¦™', 'ðŸ', 'ðŸ¦Œ', 'ðŸ•', 'ðŸ©', 'ðŸ¦®', 'ðŸ•\u200dðŸ¦º', 'ðŸˆ', 'ðŸˆ\u200dâ¬›', 'ðŸª¶', 'ðŸ“', 'ðŸ¦ƒ', 'ðŸ¦¤', 'ðŸ¦š', 'ðŸ¦œ', 'ðŸ¦¢', 'ðŸ¦©', 'ðŸ•Š', 'ðŸ‡', 'ðŸ¦', 'ðŸ¦¨', 'ðŸ¦¡', 'ðŸ¦«', 'ðŸ¦¦', 'ðŸ¦¥', 'ðŸ', 'ðŸ€', 'ðŸ¿', 'ðŸ¦”', 'ðŸ¾', 'ðŸ‰', 'ðŸ²', 'ðŸŒµ', 'ðŸŽ„', 'ðŸŒ²', 'ðŸŒ³', 'ðŸŒ´', 'ðŸª¹', 'ðŸªº', 'ðŸªµ', 'ðŸŒ±', 'ðŸŒ¿', 'â˜˜ï¸', 'ðŸ€', 'ðŸŽ', 'ðŸª´', 'ðŸŽ‹', 'ðŸƒ', 'ðŸ‚', 'ðŸ', 'ðŸ„', 'ðŸš', 'ðŸª¨', 'ðŸŒ¾', 'ðŸ’', 'ðŸŒ·', 'ðŸª·', 'ðŸŒ¹', 'ðŸ¥€', 'ðŸŒº', 'ðŸŒ¸', 'ðŸŒ¼', 'ðŸŒ»', 'ðŸŒž', 'ðŸŒ', 'ðŸŒ›', 'ðŸŒœ', 'ðŸŒš', 'ðŸŒ•', 'ðŸŒ–', 'ðŸŒ—', 'ðŸŒ˜', 'ðŸŒ‘', 'ðŸŒ’', 'ðŸŒ“', 'ðŸŒ”', 'ðŸŒ™', 'ðŸŒŽ', 'ðŸŒ', 'ðŸŒ', 'ðŸª', 'ðŸ’«', 'â­ï¸', 'ðŸŒŸ', 'âœ¨', 'âš¡ï¸', 'â˜„ï¸', 'ðŸ’¥', 'ðŸ”¥', 'ðŸŒª', 'ðŸŒˆ', 'â˜€ï¸', 'ðŸŒ¤', 'â›…ï¸', 'ðŸŒ¥', 'â˜ï¸', 'ðŸŒ¦', 'ðŸŒ§', 'â›ˆ', 'ðŸŒ©', 'ðŸŒ¨', 'â„ï¸', 'â˜ƒï¸', 'â›„ï¸', 'ðŸŒ¬', 'ðŸ’¨', 'ðŸ’§', 'ðŸ’¦', 'ðŸ«§', 'â˜”ï¸', 'â˜‚ï¸', 'ðŸŒŠ', 'ðŸŒ«', 'ðŸ', 'ðŸŽ', 'ðŸ', 'ðŸŠ', 'ðŸ‹', 'ðŸŒ', 'ðŸ‰', 'ðŸ‡', 'ðŸ“', 'ðŸ«', 'ðŸˆ', 'ðŸ’', 'ðŸ‘', 'ðŸ¥­', 'ðŸ', 'ðŸ¥¥', 'ðŸ¥', 'ðŸ…', 'ðŸ†', 'ðŸ¥‘', 'ðŸ¥¦', 'ðŸ¥¬', 'ðŸ¥’', 'ðŸŒ¶', 'ðŸ«‘', 'ðŸŒ½', 'ðŸ¥•', 'ðŸ«’', 'ðŸ§„', 'ðŸ§…', 'ðŸ¥”', 'ðŸ ', 'ðŸ¥', 'ðŸ¥¯', 'ðŸž', 'ðŸ¥–', 'ðŸ¥¨', 'ðŸ§€', 'ðŸ¥š', 'ðŸ³', 'ðŸ§ˆ', 'ðŸ¥ž', 'ðŸ§‡', 'ðŸ¥“', 'ðŸ¥©', 'ðŸ—', 'ðŸ–', 'ðŸ¦´', 'ðŸŒ­', 'ðŸ”', 'ðŸŸ', 'ðŸ•', 'ðŸ«“', 'ðŸ¥ª', 'ðŸ¥™', 'ðŸ§†', 'ðŸŒ®', 'ðŸŒ¯', 'ðŸ«”', 'ðŸ¥—', 'ðŸ¥˜', 'ðŸ«•', 'ðŸ¥«', 'ðŸ', 'ðŸœ', 'ðŸ²', 'ðŸ›', 'ðŸ£', 'ðŸ±', 'ðŸ¥Ÿ', 'ðŸ¦ª', 'ðŸ¤', 'ðŸ™', 'ðŸš', 'ðŸ˜', 'ðŸ¥', 'ðŸ¥ ', 'ðŸ¥®', 'ðŸ¢', 'ðŸ¡', 'ðŸ§', 'ðŸ¨', 'ðŸ¦', 'ðŸ¥§', 'ðŸ§', 'ðŸ°', 'ðŸŽ‚', 'ðŸ®', 'ðŸ­', 'ðŸ¬', 'ðŸ«', 'ðŸ¿', 'ðŸ©', 'ðŸª', 'ðŸŒ°', 'ðŸ¥œ', 'ðŸ¯', 'ðŸ¥›', 'ðŸ¼', 'ðŸ«–', 'â˜•ï¸', 'ðŸµ', 'ðŸ§ƒ', 'ðŸ¥¤', 'ðŸ§‹', 'ðŸ¶', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ·', 'ðŸ¥ƒ', 'ðŸ¸', 'ðŸ¹', 'ðŸ§‰', 'ðŸ¾', 'ðŸ§Š', 'ðŸ¥„', 'ðŸ´', 'ðŸ½', 'ðŸ¥£', 'ðŸ¥¡', 'ðŸ¥¢', 'ðŸ§‚', 'â¤ï¸', 'ðŸ§¡', 'ðŸ’›', 'ðŸ’š', 'ðŸ’™', 'ðŸ’œ', 'ðŸ–¤', 'ðŸ¤', 'ðŸ¤Ž', 'â¤ï¸\u200dðŸ”¥', 'â¤ï¸\u200dðŸ©¹', 'ðŸ’”', 'â£ï¸', 'ðŸ’•', 'ðŸ’ž', 'ðŸ’“', 'ðŸ’—', 'ðŸ’–', 'ðŸ’˜', 'ðŸ’']);
document.getElementById('bahar').classList.add('hidden');

function addEmojis(emojis) {
    const drawer = document.getElementById('drawer');
    for (const emoji of emojis) {
        const emojiDiv = document.createElement('div');
        emojiDiv.classList.add('emoji');
        emojiDiv.innerHTML = emoji;
        emojiDiv.onclick = () => addEmoji(emoji);
        drawer.appendChild(emojiDiv);
    }
}

function addEmoji(emoji) {
    let input = document.getElementById('input');
    let cursorPosition = input.selectionStart; // get current cursor position
    input.value = input.value.slice(0, cursorPosition) + emoji + input.value.slice(cursorPosition); // insert emoji at cursor position
    cursorPosition += emoji.length; // update cursor position
    input.setSelectionRange(cursorPosition, cursorPosition); // set cursor position to end of input field
    input.focus(); // set focus back to input field
}

function toggleEmojiDrawer() {
    drawer.style.pointerEvents = 'auto';
    if (drawer.classList.contains('hidden')) {
        drawer.classList.remove('hidden');
        document.getElementById('bahar').classList.remove('hidden');
    } else {
        drawer.classList.add('hidden');
        document.getElementById('bahar').classList.add('hidden');
        drawer.style.pointerEvents = 'none';
    }
    document.getElementById('input').focus();
}
if (drawer.classList.contains('hidden')) {
    drawer.style.pointerEvents = 'none';
}
let emojiButton = document.getElementById('emoji-button');
document.addEventListener('click', function(event) {
    let baharDiv = document.getElementById('bahar');
    let targetElement = event.target;
    if (!baharDiv.contains(targetElement) && !emojiButton.contains(targetElement.closest('.ok'))) {
        // user clicked outside of the #bahar div and the clicked element is not an emoji button or its child element, run your specific function here
        console.log('User clicked outside of the #bahar div');
        drawer.classList.add('hidden');
        document.getElementById('bahar').classList.add('hidden');
        drawer.style.pointerEvents = 'none';
    }
});
